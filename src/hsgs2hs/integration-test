#! /usr/local/plan9/bin/rc

./build-tests || exit $?

./Test || exit $?

. $GS_SPEC/bin/test-fns
. $GS_SPEC/bin/gs-spec

fn test_gsi_impl { ./test_gsi_impl.rc $* }

ok_diff_compiler '-- empty file --' hsgs2hs empty-file.hsgs empty-file.hs
ok_script '-- empty directory --' hsgs2hs-empty ./hsgs2hs ./test-fixtures/empty-dir
ok_diff_compiler '-- single line, no interpolations --' hsgs2hs single-line.hsgs single-line.hs
ok_diff_compiler '-- regular Haskell interpolation --' hsgs2hs haskell-interp.hsgs haskell-interp.hs
ok_diff_compiler '-- normal square brackets --' hsgs2hs normal-bracket.hsgs normal-bracket.hs
ok_diff_compiler '-- comments --' hsgs2hs comment.hsgs comment.hs

# Different kinds of interpolations

ok_diff_compiler '-- expression variables --' hsgs2hs variable-expression.hsgs variable-expression.hs
ok_diff_compiler '-- variable bodies --' hsgs2hs variable-body.hsgs variable-body.hs
ok_diff_compiler '-- variable bind RHSs --' hsgs2hs variable-bind.hsgs variable-bind.hs
ok_diff_compiler '-- exec binds --' hsgs2hs exec-bind-impfor.hsgs exec-bind-impfor.hs
ok_diff_compiler '-- values (thunks) --' hsgs2hs application-value.hsgs application-value.hs

# Different kinds of declarations

ok_diff_compiler '-- variable declarations --' hsgs2hs variable-decl.hsgs variable-decl.hs

# Different kinds of expressions

test_number
test_unbound_variable
test_function_variable
test_function_literal
test_variable_function_body
test_parameter_function_body
test_discard_pattern_hsgs_syntax
test_variable_pattern_hsgs_syntax
test_view_pattern_hsgs_syntax
test_view_pattern_arg_hsgs_syntax
test_view_pattern_operator_hsgs_syntax
ok_diff_compiler '-- expression applications --' hsgs2hs application-expression.hsgs application-expression.hs
test_value_function
ok_diff_compiler '-- case expressions --' hsgs2hs case-expression.hsgs case-expression.hs
ok_diff_compiled '-- for expressions --' hsgs2hs variable-for.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiler '-- impfor expressions --' hsgs2hs variable-impfor.hsgs variable-impfor.hs
ok_diff_compiler '-- case expressions where the pattern-bound variables are used --' hsgs2hs lexical-variable.hsgs lexical-variable.hs
ok_diff_compiler '-- field extractions --' hsgs2hs field-extraction.hsgs field-extraction.hs
ok_diff_compiler '-- prefix operators --' hsgs2hs prefix-expression.hsgs prefix-expression.hs
ok_diff_compiler '-- monadic generators --' hsgs2hs either-for-generator.hsgs either-for-generator.hs
ok_diff_compiler '-- monadic bind generators --' hsgs2hs either-for-bind-generator.hsgs either-for-bind-generator.hs
ok_diff_compiled '-- empty structure literals --' hsgs2hs empty-structure-literal.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- additions --' hsgs2hs natural-addition.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- lists --' hsgs2hs list-addition.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- non-associative operators --' hsgs2hs inequality.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- right-associative operators --' hsgs2hs cons.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- operator names --' hsgs2hs operator-name.hsgs .hs runghc `{./test-ghcoptions}

# log{} literals

ok_diff_compiler '-- log literals --' hsgs2hs log-literal.hsgs log-literal.hs
ok_diff_compiler '-- backslash escapes --' hsgs2hs log-backslash.hsgs log-backslash.hs
ok_diff_compiler '-- interpolations --' hsgs2hs log-interpolation.hsgs log-interpolation.hs
ok_diff_compiler '-- parentheses (in log{})--' hsgs2hs log-parens.hsgs log-parens.hs

# qq{} literals

test_qq_literal
ok_diff_compiler '-- \n in qq literals --' hsgs2hs qq-newline.hsgs qq-newline.hs
ok_diff_compiler '-- interpolations in qq literals --' hsgs2hs qq-interpolation.hsgs qq-interpolation.hs

# Different functions

ok_diff_compiler '-- error function --' hsgs2hs error-call.hsgs error-call.hs
ok_diff_compiled '-- undefined function --' hsgs2hs undefined-call.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- undefined argument --' hsgs2hs undefined-argument.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- undefined value --' hsgs2hs undefined-value.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiler '-- print-error function --' hsgs2hs print-error.hsgs print-error.hs
ok_diff_compiled '-- lambdas --' hsgs2hs lambdas.hsgs .hs runghc `{./test-ghcoptions}

# Different kinds of generators

ok_diff_compiler '-- variable definition binds --' hsgs2hs bound-variable-bind-impfor.hsgs bound-variable-bind-impfor.hs
ok_diff_compiled '-- variable definition matches --' hsgs2hs bound-variable-match.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- variable binds are in scope in subsequent generators --' hsgs2hs bound-variable-bind-in-generator.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- variable binds are in scope in subsequent monadic generators --' hsgs2hs bound-variable-bind-in-monadic-generator.hsgs .hs runghc `{./test-ghcoptions}

# Different monads

ok_diff_compiler '-- either-for --' hsgs2hs either-for.hsgs either-for.hs
