#! /usr/local/plan9/bin/rc

./build-tests || exit $?

./Test || exit $?

. $GS_SPEC/bin/test-fns
. $GS_SPEC/bin/gs-spec
. $GS_SPEC/bin/hsgs-spec

fn test_gsi_impl { ./test_gsi_impl.rc $* }

test_hsgs_empty_file
test_hsgs_non_existent_directory
test_hsgs_empty_directory
test_hsgs_no_interpolations
test_hsgs_haskell_interpolation
test_hsgs_normal_bracket
test_hsgs_comments

# Different kinds of interpolations

test_hsgs_variable_expressions
test_hsgs_variable_bodies
test_hsgs_variable_binds
test_hsgs_application_values

# Different kinds of declarations

test_hsgs_variable_declarations

# Different kinds of expressions

test_number
test_unbound_variable
test_function_variable
test_function_literal
test_variable_function_body
test_parameter_function_body
test_discard_pattern_hsgs_syntax
test_variable_pattern_hsgs_syntax
test_view_pattern_hsgs_syntax
test_view_pattern_arg_hsgs_syntax
test_view_pattern_operator_hsgs_syntax
test_expression_application_syntax
test_value_function
test_case_hsgs_syntax
test_for_variable
test_lexical_variable_hsgs_syntax
test_empty_structure_literal
test_record_literal_field
ok_diff_compiled '-- field extractions --' hsgs2hs field-extraction.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiler '-- prefix operators --' hsgs2hs prefix-expression.hsgs prefix-expression.hs
ok_diff_compiler '-- monadic generators --' hsgs2hs either-for-generator.hsgs either-for-generator.hs
ok_diff_compiler '-- monadic bind generators --' hsgs2hs either-for-bind-generator.hsgs either-for-bind-generator.hs
ok_diff_compiled '-- additions --' hsgs2hs natural-addition.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- lists --' hsgs2hs list-addition.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- non-associative operators --' hsgs2hs inequality.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- right-associative operators --' hsgs2hs cons.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- operator names --' hsgs2hs operator-name.hsgs .hs runghc `{./test-ghcoptions}

# log{} literals

ok_diff_compiler '-- log literals --' hsgs2hs log-literal.hsgs log-literal.hs
ok_diff_compiler '-- backslash escapes --' hsgs2hs log-backslash.hsgs log-backslash.hs
ok_diff_compiler '-- interpolations --' hsgs2hs log-interpolation.hsgs log-interpolation.hs
ok_diff_compiler '-- parentheses (in log{})--' hsgs2hs log-parens.hsgs log-parens.hs

# qq{} literals

test_qq_literal
ok_diff_compiler '-- \n in qq literals --' hsgs2hs qq-newline.hsgs qq-newline.hs
ok_diff_compiler '-- interpolations in qq literals --' hsgs2hs qq-interpolation.hsgs qq-interpolation.hs

# Different functions

ok_diff_compiler '-- error function --' hsgs2hs error-call.hsgs error-call.hs
ok_diff_compiled '-- undefined function --' hsgs2hs undefined-call.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- undefined argument --' hsgs2hs undefined-argument.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- undefined value --' hsgs2hs undefined-value.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiler '-- print-error function --' hsgs2hs print-error.hsgs print-error.hs
ok_diff_compiled '-- lambdas --' hsgs2hs lambdas.hsgs .hs runghc `{./test-ghcoptions}

# Different kinds of generators

test_hsgs_exec_binds
ok_diff_compiler '-- variable definition binds --' hsgs2hs bound-variable-bind-impfor.hsgs bound-variable-bind-impfor.hs
ok_diff_compiled '-- variable definition matches --' hsgs2hs bound-variable-match.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- variable binds are in scope in subsequent generators --' hsgs2hs bound-variable-bind-in-generator.hsgs .hs runghc `{./test-ghcoptions}
ok_diff_compiled '-- variable binds are in scope in subsequent monadic generators --' hsgs2hs bound-variable-bind-in-monadic-generator.hsgs .hs runghc `{./test-ghcoptions}

# Different monads

ok_diff_compiler '-- either-for --' hsgs2hs either-for.hsgs either-for.hs

# Imperative programs

ok_diff_compiler '-- impfor expressions --' hsgs2hs variable-impfor.hsgs variable-impfor.hs
