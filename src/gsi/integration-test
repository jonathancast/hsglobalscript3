#! /usr/local/plan9/bin/rc

./build-tests || exit $status

./Test || exit $status

. $GS_SPEC/bin/test-fns
. $GS_SPEC/bin/gs-spec

GLOBALSCRIPT=$HSGLOBALSCRIPT

echo '## test-gsi'

fn test_gsi_impl { ./test-gsi $* }

test_non_existent_file
test_empty_file
test_comment
test_number
test_unbound_variable
test_function_variable
test_undefined_variable
test_function_application
test_infix_operator
test_infix_with_explicit
test_function_literal
test_variable_function_body
test_parameter_function_body
test_parameter_shadows_global_variable
test_analyze_undefined
test_discard_pattern
test_view_pattern
test_view_pattern_arg

echo '## gsi'

fn test_gsi_impl { ./gsi $* }

test_non_existent_file
test_empty_file
ok_grep_errors '-- #! lines --' 'empty-shebang-line.gs:2:1: Undefined' ./gsi empty-shebang-line.gs
ok_grep_errors '-- gsmain with no arguments --' 'bare-gsmain.gsi.gs:1:1: Incorrect type: .* â†’ .* is not gsi.m' ./gsi bare-gsmain.gsi.gs

echo '## test-gsi'

fn test_gsi_impl { ./test-gsi.gsi.gs $* }

test_non_existent_file
