#! /usr/local/plan9/bin/rc -e

./build-tests

./Test

. $GS_SPEC/bin/test-fns

GLOBALSCRIPT=$HSGLOBALSCRIPT

echo '## test-gsi'

ok_grep_errors '-- non-existent source file --' 'no-such-file.gs: Could not load' ./test-gsi no-such-file.gs
ok_grep_errors '-- variable not in scope --' 'foo not in scope' ./test-gsi unbound-variable.gs
ok_grep_errors '-- empty source file --' 'empty-file.gs:1:1: Undefined' ./test-gsi empty-file.gs
ok_diff '-- function variable --' ./test-gsi bare-gsmain.gsi.gs

echo '## gsi'

ok_grep_errors '-- non-existent source file --' 'no-such-file.gs: Could not load' ./gsi no-such-file.gs
ok_grep_errors '-- empty source file --' 'empty-file.gs:1:1: Undefined' ./gsi empty-file.gs
ok_grep_errors '-- #! lines --' 'empty-shebang-line.gs:2:1: Undefined' ./gsi empty-shebang-line.gs
ok_grep_errors '-- gsmain with no arguments --' 'bare-gsmain.gsi.gs:1:1: Incorrect type: .* â†’ .* is not gsi.m' ./gsi bare-gsmain.gsi.gs
