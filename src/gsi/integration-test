#! /usr/local/plan9/bin/rc

./build-tests || exit $status

./Test || exit $status

. $GS_SPEC/bin/test-fns
. $GS_SPEC/bin/gs-spec

GLOBALSCRIPT=$HSGLOBALSCRIPT

echo '## test-gsi'

fn test_gsi_impl { ./test-gsi $* }

test_non_existent_file
test_empty_file
test_unbound_file
ok_diff '-- function variable --' ./test-gsi bare-gsmain.gsi.gs
ok_grep_errors '-- undefined variable --' 'undefined.gs:1:1: Undefined' ./test-gsi undefined.gs
ok_grep_errors '-- function application --' 'function-application.gs:1:1: Undefined' ./test-gsi function-application.gs

echo '## gsi'

fn test_gsi_impl { ./gsi $* }

test_non_existent_file
test_empty_file
ok_grep_errors '-- #! lines --' 'empty-shebang-line.gs:2:1: Undefined' ./gsi empty-shebang-line.gs
ok_grep_errors '-- gsmain with no arguments --' 'bare-gsmain.gsi.gs:1:1: Incorrect type: .* â†’ .* is not gsi.m' ./gsi bare-gsmain.gsi.gs

echo '## test-gsi'

fn test_gsi_impl { ./test-gsi.gsi.gs $* }

test_non_existent_file
